<!DOCTYPE HTML>
<html lang="en">
<head><link rel="icon" href="../../../../favicon-checkerframework.png" type="image/png"/>
<!-- Generated by javadoc (21) -->
<title>MustCallConsistencyAnalyzer (checker-framework 3.49.3-eisop1 API)</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="description" content="declaration: package: org.checkerframework.checker.resourceleak, class: MustCallConsistencyAnalyzer">
<meta name="generator" content="javadoc/ClassWriterImpl">
<link rel="stylesheet" type="text/css" href="../../../../stylesheet.css" title="Style">
<link rel="stylesheet" type="text/css" href="../../../../script-dir/jquery-ui.min.css" title="Style">
<script type="text/javascript" src="../../../../script.js"></script>
<script type="text/javascript" src="../../../../script-dir/jquery-3.7.1.min.js"></script>
<script type="text/javascript" src="../../../../script-dir/jquery-ui.min.js"></script>
</head>
<body class="class-declaration-page">
<script type="text/javascript">var pathtoroot = "../../../../";
loadScripts(document, 'script');</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<div class="flex-box">
<header role="banner" class="flex-header">
<nav role="navigation">
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="top-nav" id="navbar-top"><button id="navbar-toggle-button" aria-controls="navbar-top" aria-expanded="false" aria-label="Toggle navigation links"><span class="nav-bar-toggle-icon">&nbsp;</span><span class="nav-bar-toggle-icon">&nbsp;</span><span class="nav-bar-toggle-icon">&nbsp;</span></button>
<div class="skip-nav"><a href="#skip-navbar-top" title="Skip navigation links">Skip navigation links</a></div>
<ul id="navbar-top-firstrow" class="nav-list" title="Navigation">
<li><a href="../../../../index.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="nav-bar-cell1-rev">Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../index-all.html">Index</a></li>
<li><a href="../../../../help-doc.html#class">Help</a></li>
</ul>
<ul class="sub-nav-list-small">
<li>
<p>Summary:</p>
<ul>
<li><a href="#nested-class-summary">Nested</a></li>
<li>Field</li>
<li><a href="#constructor-summary">Constr</a></li>
<li><a href="#method-summary">Method</a></li>
</ul>
</li>
<li>
<p>Detail:</p>
<ul>
<li>Field</li>
<li><a href="#constructor-detail">Constr</a></li>
<li><a href="#method-detail">Method</a></li>
</ul>
</li>
</ul>
</div>
<div class="sub-nav">
<div id="navbar-sub-list">
<ul class="sub-nav-list">
<li>Summary:&nbsp;</li>
<li><a href="#nested-class-summary">Nested</a>&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor-summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method-summary">Method</a></li>
</ul>
<ul class="sub-nav-list">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor-detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method-detail">Method</a></li>
</ul>
</div>
<div class="nav-list-search"><a href="../../../../search.html">SEARCH</a>
<input type="text" id="search-input" disabled placeholder="Search">
<input type="reset" id="reset-button" disabled value="reset">
</div>
</div>
<!-- ========= END OF TOP NAVBAR ========= -->
<span class="skip-nav" id="skip-navbar-top"></span></nav>
</header>
<div class="flex-content">
<main role="main">
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="sub-title"><span class="package-label-in-type">Package</span>&nbsp;<a href="package-summary.html">org.checkerframework.checker.resourceleak</a></div>
<h1 title="Class MustCallConsistencyAnalyzer" class="title">Class MustCallConsistencyAnalyzer</h1>
</div>
<div class="inheritance" title="Inheritance Tree"><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Object.html" title="class or interface in java.lang" class="external-link">java.lang.Object</a>
<div class="inheritance">org.checkerframework.checker.resourceleak.MustCallConsistencyAnalyzer</div>
</div>
<section class="class-description" id="class-description">
<hr>
<div class="type-signature"><span class="modifiers">public class </span><span class="element-name type-name-label">MustCallConsistencyAnalyzer</span>
<span class="extends-implements">extends <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Object.html" title="class or interface in java.lang" class="external-link">Object</a></span></div>
<div class="block">An analyzer that checks consistency of <a href="../mustcall/qual/MustCall.html" title="annotation interface in org.checkerframework.checker.mustcall.qual"><code>MustCall</code></a> and <a href="../calledmethods/qual/CalledMethods.html" title="annotation interface in org.checkerframework.checker.calledmethods.qual"><code>CalledMethods</code></a> types, thereby
 detecting resource leaks. For any expression <em>e</em> the analyzer ensures that when <em>e</em>
 goes out of scope, there exists a resource alias <em>r</em> of <em>e</em> (which might be
 <em>e</em> itself) such that the must-call methods of <em>r</em> (i.e. the values of <em>r</em>'s
 MustCall type) are contained in the value of <em>r</em>'s CalledMethods type. For any <em>e</em>
 for which this property does not hold, the analyzer reports a <code>
 "required.method.not.called"</code> error, indicating a possible resource leak.

 <p>Mechanically, the analysis does two tasks.

 <ul>
   <li>Tracks must-aliases, implemented via a dataflow analysis. Each dataflow fact is a set of
       resource-aliases that refer to the same resource. Furthermore, that resource is owned. No
       dataflow facts are maintained for a non-owned resource.
   <li>When the last resource alias in a resource-alias set goes out-of-scope, it checks their
       must-call and called-methods types. The analysis does not track must-call or called-methods
       types, but queries other checkers to obtain them.
 </ul>

 <p>Class <code>MustCallConsistencyAnalyzer.Obligation</code> represents a single such dataflow fact. Abstractly, each dataflow
 fact is a pair: a set of resource aliases to some resource, and the must-call obligations of that
 resource (i.e the list of must-call methods that need to be called on one of the resource
 aliases). Concretely, the Must Call Checker is responsible for tracking the latter - an
 expression's must-call type indicates which methods must be called - so this dataflow analysis
 only actually tracks the sets of resource aliases.

 <p>The dataflow algorithm adds, modifies, or removes dataflow facts when certain code patterns
 are encountered, to account for ownership transfer. Here are non-exhaustive examples:

 <ul>
   <li>A new fact is added to the tracked set when a constructor or a method with an owning return
       is invoked.
   <li>A fact is modified when an expression with a tracked Obligation is the RHS of a
       (pseudo-)assignment. The LHS is added to the existing resource alias set.
   <li>A fact can be removed when a member of a resource-alias set is assigned to an owning field
       or passed to a method in a parameter location that is annotated as <code>@Owning</code>.
 </ul>

 <p>The dataflow analysis for these Obligations is conservative in that it guarantees that for
 every resource which actually does have a must-call obligation, at least one Obligation will
 exist. However, it does not guarantee the opposite: Obligations may also exist for resources
 without a must-call obligation (or for non-resources) as a result of analysis imprecision. That
 is, the set of Obligations tracked by the analysis over-approximates the actual set of resources
 in the analyzed program with must-call obligations.

 <p>Throughout, this class uses the temporary-variable facilities provided by the Must Call and
 Resource Leak type factories both to emulate a three-address-form IR (simplifying some analysis
 logic) and to permit expressions to have their types refined in their respective checkers'
 stores. These temporary variables can be members of resource-alias sets. Without temporary
 variables, the checker wouldn't be able to verify code such as <code>new Socket(host,
 port).close()</code>, which would cause false positives. Temporaries are created for <code>new</code>
 expressions, method calls (for the return value), and ternary expressions. Other types of
 expressions may be supported in the future.</div>
</section>
<section class="summary">
<ul class="summary-list">
<!-- ======== NESTED CLASS SUMMARY ======== -->
<li>
<section class="nested-class-summary" id="nested-class-summary">
<h2>Nested Class Summary</h2>
<div class="caption"><span>Nested Classes</span></div>
<div class="summary-table three-column-summary">
<div class="table-header col-first">Modifier and Type</div>
<div class="table-header col-second">Class</div>
<div class="table-header col-last">Description</div>
<div class="col-first even-row-color"><code>static enum&nbsp;</code></div>
<div class="col-second even-row-color"><code><a href="MustCallConsistencyAnalyzer.MethodExitKind.html" class="type-name-link" title="enum class in org.checkerframework.checker.resourceleak">MustCallConsistencyAnalyzer.MethodExitKind</a></code></div>
<div class="col-last even-row-color">
<div class="block">A description for how a method might exit.</div>
</div>
</div>
</section>
</li>
<!-- ======== CONSTRUCTOR SUMMARY ======== -->
<li>
<section class="constructor-summary" id="constructor-summary">
<h2>Constructor Summary</h2>
<div class="caption"><span>Constructors</span></div>
<div class="summary-table two-column-summary">
<div class="table-header col-first">Constructor</div>
<div class="table-header col-last">Description</div>
<div class="col-constructor-name even-row-color"><code><a href="#%3Cinit%3E(org.checkerframework.checker.resourceleak.ResourceLeakChecker)" class="member-name-link">MustCallConsistencyAnalyzer</a><wbr>(<a href="ResourceLeakChecker.html" title="class in org.checkerframework.checker.resourceleak">ResourceLeakChecker</a>&nbsp;rlc)</code></div>
<div class="col-last even-row-color">
<div class="block">Creates a consistency analyzer.</div>
</div>
</div>
</section>
</li>
<!-- ========== METHOD SUMMARY =========== -->
<li>
<section class="method-summary" id="method-summary">
<h2>Method Summary</h2>
<div id="method-summary-table">
<div class="table-tabs" role="tablist" aria-orientation="horizontal"><button id="method-summary-table-tab0" role="tab" aria-selected="true" aria-controls="method-summary-table.tabpanel" tabindex="0" onkeydown="switchTab(event)" onclick="show('method-summary-table', 'method-summary-table', 3)" class="active-table-tab">All Methods</button><button id="method-summary-table-tab1" role="tab" aria-selected="false" aria-controls="method-summary-table.tabpanel" tabindex="-1" onkeydown="switchTab(event)" onclick="show('method-summary-table', 'method-summary-table-tab1', 3)" class="table-tab">Static Methods</button><button id="method-summary-table-tab2" role="tab" aria-selected="false" aria-controls="method-summary-table.tabpanel" tabindex="-1" onkeydown="switchTab(event)" onclick="show('method-summary-table', 'method-summary-table-tab2', 3)" class="table-tab">Instance Methods</button><button id="method-summary-table-tab4" role="tab" aria-selected="false" aria-controls="method-summary-table.tabpanel" tabindex="-1" onkeydown="switchTab(event)" onclick="show('method-summary-table', 'method-summary-table-tab4', 3)" class="table-tab">Concrete Methods</button></div>
<div id="method-summary-table.tabpanel" role="tabpanel" aria-labelledby="method-summary-table-tab0">
<div class="summary-table three-column-summary">
<div class="table-header col-first">Modifier and Type</div>
<div class="table-header col-second">Method</div>
<div class="table-header col-last">Description</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>void</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#analyze(org.checkerframework.dataflow.cfg.ControlFlowGraph)" class="member-name-link">analyze</a><wbr>(<a href="../../dataflow/cfg/ControlFlowGraph.html" title="class in org.checkerframework.dataflow.cfg">ControlFlowGraph</a>&nbsp;cfg)</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">The main function of the consistency dataflow analysis.</div>
</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4"><code>static <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a></code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4"><code><a href="#formatMissingMustCallMethods(java.util.List)" class="member-name-link">formatMissingMustCallMethods</a><wbr>(<a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/List.html" title="class or interface in java.util" class="external-link">List</a>&lt;<a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&gt;&nbsp;mustCallVal)</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4">
<div class="block">Formats a list of must-call method names to be printed in an error message.</div>
</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>boolean</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#shouldTrackInvocationResult(java.util.Set,org.checkerframework.dataflow.cfg.node.Node,boolean)" class="member-name-link">shouldTrackInvocationResult</a><wbr>(<a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/Set.html" title="class or interface in java.util" class="external-link">Set</a>&lt;org.checkerframework.checker.resourceleak.MustCallConsistencyAnalyzer.Obligation&gt;&nbsp;obligations,
 <a href="../../dataflow/cfg/node/Node.html" title="class in org.checkerframework.dataflow.cfg.node">Node</a>&nbsp;node,
 boolean&nbsp;isMustCallInference)</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">Returns true if the result of the given method or constructor invocation node should be
 tracked in <code>obligations</code>.</div>
</div>
</div>
</div>
</div>
<div class="inherited-list">
<h3 id="methods-inherited-from-class-java.lang.Object">Methods inherited from class&nbsp;java.lang.<a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Object.html" title="class or interface in java.lang" class="external-link">Object</a></h3>
<code><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Object.html#clone()" title="class or interface in java.lang" class="external-link">clone</a>, <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Object.html#equals(java.lang.Object)" title="class or interface in java.lang" class="external-link">equals</a>, <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Object.html#finalize()" title="class or interface in java.lang" class="external-link">finalize</a>, <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Object.html#getClass()" title="class or interface in java.lang" class="external-link">getClass</a>, <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Object.html#hashCode()" title="class or interface in java.lang" class="external-link">hashCode</a>, <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Object.html#notify()" title="class or interface in java.lang" class="external-link">notify</a>, <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Object.html#notifyAll()" title="class or interface in java.lang" class="external-link">notifyAll</a>, <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Object.html#toString()" title="class or interface in java.lang" class="external-link">toString</a>, <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Object.html#wait()" title="class or interface in java.lang" class="external-link">wait</a>, <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Object.html#wait(long)" title="class or interface in java.lang" class="external-link">wait</a>, <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Object.html#wait(long,int)" title="class or interface in java.lang" class="external-link">wait</a></code></div>
</section>
</li>
</ul>
</section>
<section class="details">
<ul class="details-list">
<!-- ========= CONSTRUCTOR DETAIL ======== -->
<li>
<section class="constructor-details" id="constructor-detail">
<h2>Constructor Details</h2>
<ul class="member-list">
<li>
<section class="detail" id="&lt;init&gt;(org.checkerframework.checker.resourceleak.ResourceLeakChecker)">
<h3>MustCallConsistencyAnalyzer</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="element-name">MustCallConsistencyAnalyzer</span><wbr><span class="parameters">(<a href="ResourceLeakChecker.html" title="class in org.checkerframework.checker.resourceleak">ResourceLeakChecker</a>&nbsp;rlc)</span></div>
<div class="block">Creates a consistency analyzer. Typically, the type factory's postAnalyze method would
 instantiate a new consistency analyzer using this constructor and then call <a href="#analyze(org.checkerframework.dataflow.cfg.ControlFlowGraph)"><code>analyze(ControlFlowGraph)</code></a>.</div>
<dl class="notes">
<dt>Parameters:</dt>
<dd><code>rlc</code> - the resource leak checker</dd>
</dl>
</section>
</li>
</ul>
</section>
</li>
<!-- ============ METHOD DETAIL ========== -->
<li>
<section class="method-details" id="method-detail">
<h2>Method Details</h2>
<ul class="member-list">
<li>
<section class="detail" id="analyze(org.checkerframework.dataflow.cfg.ControlFlowGraph)">
<h3>analyze</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type">void</span>&nbsp;<span class="element-name">analyze</span><wbr><span class="parameters">(<a href="../../dataflow/cfg/ControlFlowGraph.html" title="class in org.checkerframework.dataflow.cfg">ControlFlowGraph</a>&nbsp;cfg)</span></div>
<div class="block">The main function of the consistency dataflow analysis. The analysis tracks dataflow facts
 ("Obligations") of type <code>MustCallConsistencyAnalyzer.Obligation</code>, each representing a set of owning resource
 aliases for some value with a non-empty <code>@MustCall</code> obligation. The set of tracked
 Obligations is guaranteed to include at least one Obligation for each actual resource in the
 program, but might include other, spurious Obligations, too (that is, it is a conservative
 over-approximation of the true Obligation set).

 <p>The analysis improves its precision by removing Obligations from tracking when it can
 prove that they do not represent real resources. For example, it is not necessary to track
 expressions with empty <code>@MustCall</code> obligations, because they are trivially fulfilled.
 Nor is tracking non-owning aliases necessary, because by definition they cannot be used to
 fulfill must-call obligations.</div>
<dl class="notes">
<dt>Parameters:</dt>
<dd><code>cfg</code> - the control flow graph of the method to check</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="shouldTrackInvocationResult(java.util.Set,org.checkerframework.dataflow.cfg.node.Node,boolean)">
<h3>shouldTrackInvocationResult</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type">boolean</span>&nbsp;<span class="element-name">shouldTrackInvocationResult</span><wbr><span class="parameters">(<a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/Set.html" title="class or interface in java.util" class="external-link">Set</a>&lt;org.checkerframework.checker.resourceleak.MustCallConsistencyAnalyzer.Obligation&gt;&nbsp;obligations,
 <a href="../../dataflow/cfg/node/Node.html" title="class in org.checkerframework.dataflow.cfg.node">Node</a>&nbsp;node,
 boolean&nbsp;isMustCallInference)</span></div>
<div class="block">Returns true if the result of the given method or constructor invocation node should be
 tracked in <code>obligations</code>. In some cases, there is no need to track the result because
 the must-call obligations are already satisfied in some other way or there cannot possibly be
 must-call obligations because of the structure of the code.

 <p>Specifically, an invocation result does NOT need to be tracked if any of the following is
 true:

 <ul>
   <li>The invocation is a call to a <code>this()</code> or <code>super()</code> constructor.
   <li>The method's return type is annotated with MustCallAlias and the argument passed in
       this invocation in the corresponding position is an owning field.
   <li>The method's return type is non-owning, which can either be because the method has no
       return type or because the return type is annotated with <a href="../mustcall/qual/NotOwning.html" title="annotation interface in org.checkerframework.checker.mustcall.qual"><code>NotOwning</code></a>.
 </ul>

 <p>This method can also side-effect <code>obligations</code>, if node is a super or this
 constructor call with MustCallAlias annotations, by removing that Obligation.</div>
<dl class="notes">
<dt>Parameters:</dt>
<dd><code>obligations</code> - the current set of Obligations, which may be side-effected</dd>
<dd><code>node</code> - the invocation node to check; must be <a href="../../dataflow/cfg/node/MethodInvocationNode.html" title="class in org.checkerframework.dataflow.cfg.node"><code>MethodInvocationNode</code></a> or <a href="../../dataflow/cfg/node/ObjectCreationNode.html" title="class in org.checkerframework.dataflow.cfg.node"><code>ObjectCreationNode</code></a></dd>
<dd><code>isMustCallInference</code> - true if this method is invoked as part of a MustCall inference</dd>
<dt>Returns:</dt>
<dd>true iff the result of <code>node</code> should be tracked in <code>obligations</code></dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="formatMissingMustCallMethods(java.util.List)">
<h3>formatMissingMustCallMethods</h3>
<div class="member-signature"><span class="modifiers">public static</span>&nbsp;<span class="return-type"><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a></span>&nbsp;<span class="element-name">formatMissingMustCallMethods</span><wbr><span class="parameters">(<a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/List.html" title="class or interface in java.util" class="external-link">List</a>&lt;<a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&gt;&nbsp;mustCallVal)</span></div>
<div class="block">Formats a list of must-call method names to be printed in an error message.</div>
<dl class="notes">
<dt>Parameters:</dt>
<dd><code>mustCallVal</code> - the list of must-call strings</dd>
<dt>Returns:</dt>
<dd>a formatted string</dd>
</dl>
</section>
</li>
</ul>
</section>
</li>
</ul>
</section>
<!-- ========= END OF CLASS DATA ========= -->
</main>
</div>
</div>
</body>
</html>
